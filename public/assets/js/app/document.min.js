$(document).ready(function() {
    var is_valid_token =
    sessionStorage.getItem("login_token") === null ? false : true;
    var is_profile_name =
    sessionStorage.getItem("profile_name") === null ? false : true;
    if(is_valid_token && is_profile_name){
        hideUserMenu();
        $(".navbar").css("width", "33%");
        $(".navbar").css("margin-left", "34%");
    }
});

$(document).ready(function () {
    $(document).ajaxStart(function () {
       // Show loading image
       $("#page_loader").show();
    });
 
    $(document).ajaxStop(function () {
       // Hide loading image
       $("#page_loader").hide();
    });
 });
 
function hideUserMenu() {
    $(".before-login-menu").removeClass("show").addClass("hide");
    $(".after-login-menu").removeClass("hide").addClass("show");
}

$(document).on("click", ".btn-get-register", function () {
    var error = false;
    var mobileNo = getValById("mobileNo");
    var random = $('meta[name="random-key"]').attr("content");

    hideError("mobileNo");

    if (
        mobileNo == "" ||
        mobileNo.length < 10
    ) {
        error = true;
        showError("mobileNo", "Please enter valid mobile number");
    }
    
    if (!error) {
        var params = {
            mobile_no: encryptByAES(mobileNo, random),
            random: random,
        };
    
        $.ajax({
            url: BASE_URL + "generate-mobile-otp",
            type: "post",
            data: params,
            dataType: "json",
            headers: {
                "X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr("content"),
            },
            cache: false,
            beforeSend: function () {
                $(".btn-get-register").attr("disabled", true);
            },
            success: function (response) {
                if (response.error) {
                    $(".btn-get-register").attr("disabled", false);
                    showSnacBar(response.message, "error");
                } else {
                    setTimeout("redirectToLogin()", 3000);
                    showSnacBar(response.message, "success");
                }
            },
        });
    }
});

$(document).on("click", ".btn-get-code", function () {
    var error = false;
    var LogmobileNo = getValById("loginMobileNo");
    var random = $('meta[name="random-key"]').attr("content");

    hideError("LogmobileNo");

    if (
        LogmobileNo == "" ||
        LogmobileNo.length < 10
    ) {
        error = true;
        showError("loginMobileNo", "Please enter valid mobile number");
    }

    if (!error) {
        var params = {
            Login_mobile_no: encryptByAES(LogmobileNo, random),
            random: random,
        };
    
        $.ajax({
            url: BASE_URL + "generate-mobile-secretcode",
            type: "post",
            data: params,
            dataType: "json",
            headers: {
                "X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr("content"),
            },
            cache: false,
            beforeSend: function () {
                $(".btn-get-code").addClass("hide").removeClass("show");
                $("#loginMobileNo").attr("disabled", true);
            },
            success: function (response) {
                if (response.error) {
                    $(".btn-get-code").addClass("show").removeClass("hide");
                    $("#loginMobileNo").val('');
                    showSnacBar(response.message, "error");
                } else{
                    $(".otp_gen_resp").addClass("show").removeClass("hide");
                    sessionStorage.setItem("login_token", response.token);
                    $("#otp_num").val(response.secret_key);
                    $(".otp_gen_resp").addClass("show").removeClass("hide");
                    showSnacBar(response.message, "success");
                }
            },
        });
    }
});


$(document).on("click", ".btn-verify-login-otp", function () {
    var error = false;
    var LogmobileNo = getValById("loginMobileNo");
    var secret_key  = getValById("otp_num");
    var fullName    = getValById("fullname");
    var login_token = sessionStorage.getItem('login_token');
    var random = $('meta[name="random-key"]').attr("content");

    hideError("fullname");

    if (
        fullName == "" ||
        fullName.length >=20
    ) {
        error = true;
        showError("fullname", "Please enter valid name");
    }

    hideError("LogmobileNo");

    if (
        LogmobileNo == "" ||
        LogmobileNo.length < 10
    ) {
        error = true;
        showError("loginMobileNo", "Please enter valid mobile number");
    }
    hideError("otp_num");

    if (
        secret_key == "" ||
        secret_key.length > 6
    ) {
        error = true;
        showError("otp_num", "Please enter valid secret key");
    }

    if (!error) {
        var params = {
            Login_mobile_no: encryptByAES(LogmobileNo, random),
            fullname :fullName.toUpperCase(),
            secret_key : secret_key,
            login_token: login_token,
            random: random,
        };
    
        $.ajax({
            url: BASE_URL + "verify-mobile-secretcode",
            type: "post",
            data: params,
            dataType: "json",
            headers: {
                "X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr("content"),
            },
            cache: false,
            beforeSend: function () {
                $(".btn-verify-login-otp").attr("disabled", true);
                $("#otp_num").val(encryptByAES(secret_key, random));
                $("#fullname").val(fullName.toUpperCase());
                $("#fullname").attr("disabled", true);
                $("#otp_num"). attr("disabled", true);
            },
            success: function (response) {
                if (response.error) {
                    $(".btn-get-code").addClass("show").removeClass("hide");
                    $(".otp_gen_resp").addClass("hide").removeClass("show");
                    $("#loginMobileNo").val('');
                    $("#loginMobileNo").attr("disabled", false);
                    showSnacBar(response.message, "error");
                } else{
                    sessionStorage.setItem("login_token", response.login_token);
                    sessionStorage.setItem("login_time", response.login_time);
                    sessionStorage.setItem("profile_name", response.profile_name);
                    sessionStorage.setItem("login_expired", response.expired_on);
                    $(".welcome-message").addClass("show").removeClass("hide");
                    setTimeout("HomePage()", 3000);
                    showSnacBar(response.message, "success");
                }
            },
        });
    }
});

$(document).on("click", ".log-out", function () {
    Swal.fire({
        title: "Are you sure?",
        text: "Press the button what you want!",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#3085d6",
        cancelButtonColor: "#d33",
        confirmButtonText: "Yes, Log out!"
      }).then((result) => {
        if (result.isConfirmed) {
            $.ajax({
                url: BASE_URL + "log-out",
                type: 'GET',
                dataType: "json",
                headers: {
                    "X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr("content"),
                },
                cache: false,
                success: function (response) {
                    console.log(response);
                    if (response.error) {
                        showSnacBar(response.message, "error");
                    }else{
                        sessionStorage.clear();
                        showSnacBar(response.message, "success");
                        setTimeout("HomePage()", 3000);
                    }
                },
            });
        }
    });
});


$(document).on("click", "#btn-select-package", function () {
    /*alert(sessionStorage.getItem("login_token"));*/
    var error   =   false;
    let package_id  =   $(this).attr("data-id");
    if(sessionStorage.getItem("login_token")    ==  null   
    &&  sessionStorage.getItem("profile_name")    ==  null){
        setTimeout("redirectToLogin()", 2000);
    }else{
        switch(package_id) {
            case "1":
                error = false;
                break;
            case "2":
                error = false;
                break;
            case "3":
                error = false;
                break;
            default:
                error = true;
                showSnacBar("Please don't change the data-id from the console!!", "error");
        }
        var login_token     =   sessionStorage.getItem("login_token");
        if (!error) {
            var params = {
                login_token: login_token,
                package_id: package_id,
            };
        
            $.ajax({
                url: BASE_URL + "book-event",
                type: "post",
                data: params,
                dataType: "json",
                headers: {
                    "X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr("content"),
                },
                cache: false,
                beforeSend: function () {
                    $("#btn-select-package").attr("disabled",true);
                },
                success: function (response) {
                    if(response.error){
                        $("#btn-select-package").attr("disabled",false);
                        showSnacBar(response.message, "error");
                    }else{
                        $("#btn-select-package").attr("disabled",false);
                        Swal.fire({
                            title: "Good job!",
                            text: "Hurray..."+response.message,
                            icon: "success",
                            timer: 3000,
                          });
                    }
                }
            });
        }
    }


});

$(document).ready(function(){
    // Set a delay of 3000 milliseconds (3 seconds) before hiding the alert
    setTimeout(function(){
        $('#successAlert').fadeOut('slow');
    }, 5000);
});

function redirectToLogin() {
    window.location.href = BASE_URL + "log-in";
}

function HomePage() {
    window.location.href = BASE_URL;
}
